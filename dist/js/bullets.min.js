/*
 bullets 2016-06-23 
*/
function vec2(a,b){return{x:a,y:b}}function randColor(){return"#"+Math.floor(16777215*Math.random()).toString(16)}function randInt(a,b){return Math.round(Math.random()*b)-a}function addBullet(a){bullets.array.push(a)}var kb={up:!1,down:!1,right:!1,left:!1};Mousetrap.bind("up",function(){kb.up=!0},"keydown"),Mousetrap.bind("up",function(){kb.up=!1},"keyup"),Mousetrap.bind("down",function(){kb.down=!0},"keydown"),Mousetrap.bind("down",function(){kb.down=!1},"keyup"),Mousetrap.bind("right",function(){kb.right=!0},"keydown"),Mousetrap.bind("right",function(){kb.right=!1},"keyup"),Mousetrap.bind("left",function(){kb.left=!0},"keydown"),Mousetrap.bind("left",function(){kb.left=!1},"keyup");var draw={circle:function(a,b,c,d){a.fillStyle=d,a.beginPath(),a.arc(b.x,b.y,c,0,2*Math.PI),a.fill()},line:function(a,b,c,d,e){a.beginPath(),a.moveTo(b.x,b.y),a.lineTo(c.x,c.y),a.lineWidth=d,a.strokeStyle=e,a.stroke()},clear:function(a,b){a.fillStyle="white",a.fillRect(0,0,b.width,b.height)},text:function(a,b,c,d,e){a.fillStyle=d,a.font=c.toString()+"px Arial",a.fillText(b,e.x,e.y)},menu:function(){}},menuCanvas=document.getElementById("menuCanvas"),m=menuCanvas.getContext("2d");menuCanvas.width=512,menuCanvas.height=32;var m=menuCanvas.getContext("2d"),gameCanvas=document.getElementById("gameCanvas");gameCanvas.width=512,gameCanvas.height=512;var g=gameCanvas.getContext("2d"),player={type:"player",pos:vec2(gameCanvas.width/2,gameCanvas.height/2),radius:5,speed:3,deinc:.1,color:"#333"},pattern={down:function(a){a.pos.y+=a.speedpos.y},sideWays:function(a){a.pos.y+=a.speedpos.y,a.pos.x+=a.speedpos.x},wavyDown:function(a){a.pos.y+=a.speedpos.y+Math.sin(frame/30),a.pos.x+=2*Math.sin(frame/(40*a.speedpos.x))},awayFromCenter:function(a,b){}},bullets={array:[]},func={applyPlayerSpeed:function(a){player.speed>0&&(kb.up&&(a.pos.y-=player.speed),kb.down&&(a.pos.y+=player.speed),kb.right&&(a.pos.x+=player.speed),kb.left&&(a.pos.x-=player.speed))},pytha:function(a,b){return Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y))},distanceCheck:function(a,b){return pytha=func.pytha(a.pos,b.pos),pytha<a.radius+b.radius},unclog:function(a,b){var c=Math.acos((a.pos.x-b.pos.x)/func.pytha(a.pos,b.pos));b.pos.x=a.pos.x-Math.cos(c)*(a.radius+b.radius),b.pos.y<a.pos.y?b.pos.y=a.pos.y-Math.sin(c)*(a.radius+b.radius):b.pos.y=a.pos.y+Math.sin(c)*(a.radius+b.radius)},squareCheck:function(a,b){return!(a.pos.x+a.radius<b.pos.x-b.radius||a.pos.y+a.radius<b.pos.y-b.radius||a.pos.x-a.radius>b.pos.x+b.radius||a.pos.y-a.radius>b.pos.y+b.radius)}},update={collision:function(a){if(a.isConnected)for(var b=0,c=bullets.array.length;b<c;b++){var d=bullets.array[b];!d.isConnected&&func.squareCheck(a,d)&&func.distanceCheck(a,d)&&(func.unclog(a,d),d.isConnected=!0,player.speed-=d.radius/120)}else func.squareCheck(player,a)&&func.distanceCheck(player,a)?(func.unclog(player,a),a.isConnected=!0,player.speed-=a.radius/120):(a.pattern(a),update.swapArround(a))},swapArround:function(a){a.pos.y<gameCanvas.height*-.1&&(a.pos.y+=1.2*gameCanvas.height),a.pos.y>1.1*gameCanvas.height&&(a.pos.y-=1.2*gameCanvas.height),a.pos.x>1.1*gameCanvas.width&&(a.pos.x-=1.2*gameCanvas.height),a.pos.x<gameCanvas.width*-.1&&(a.pos.x+=1.2*gameCanvas.height)}},frame=-1,loop={menu:function(){frame++,requestAnimationFrame(loop.cur)},game:function(){frame++,draw.clear(g,gameCanvas),func.applyPlayerSpeed(player),update.swapArround(player),draw.circle(g,player.pos,player.radius,player.color);for(var a=0,b=bullets.array.length;a<b;a++){var c=bullets.array[a];c.xspeed+=5e-4,c.yspeed+=5e-4,c.isConnected&&func.applyPlayerSpeed(c),update.collision(c,a),draw.circle(g,c.pos,c.radius,c.color)}frame%60===0&&addBullet({pos:vec2(randInt(0,gameCanvas.width),randInt(0,gameCanvas.height)),radius:6+randInt(0,8),color:randColor(),speedpos:vec2(1+2*Math.random(),1+2*Math.random()),pattern:pattern.wavyDown}),draw.text(m,"meme",10,"black",vec2(menuCanvas.width/2,menuCanvas.height/2)),requestAnimationFrame(loop.cur)}};loop.cur=loop.game,loop.cur();