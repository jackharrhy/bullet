/*
 bullets 2016-04-18 
*/
function fixBulletPos(a){if(a.pos.y<gameCanvas.height*-.1&&(a.pos.y+=1.2*gameCanvas.height),a.pos.y>1.1*gameCanvas.height&&(a.pos.y-=1.2*gameCanvas.height),a.pos.x>1.1*gameCanvas.width&&(a.pos.x-=1.2*gameCanvas.height),a.pos.x<gameCanvas.width*-.1&&(a.pos.x+=1.2*gameCanvas.height),"player"==a.type)for(var b=0,c=bullets.array.length;c>b;b++){var d=bullets.array[b];d.isConnected&&(d.pos.y>1.1*gameCanvas.height&&(d.pos.y-=1.2*gameCanvas.height),d.pos.x>1.1*gameCanvas.width&&(d.pos.x-=1.2*gameCanvas.height),d.pos.x<gameCanvas.width*-.1&&(d.pos.x+=1.2*gameCanvas.height))}}function randColor(){return"#"+Math.floor(16777215*Math.random()).toString(16)}function randInt(a,b){return Math.round(Math.random()*b)-a}function generateBullet(a){var b={type:"bullet",pos:{x:a,y:0},radius:6+4*Math.random(),fillColor:randColor(),yspeed:1+2*Math.random(),xspeed:1+2*Math.random(),pattern:pattern.sideWays};bullets.array.push(b)}var menuCanvas=document.getElementById("menuCanvas"),m=menuCanvas.getContext("2d"),gameCanvas=document.getElementById("gameCanvas"),g=gameCanvas.getContext("2d");gameCanvas.width=512,gameCanvas.height=512,menuCanvas.width=512,menuCanvas.height=32;var player={type:"player",pos:{x:gameCanvas.width/2,y:gameCanvas.height/2},radius:5,speed:3,deinc:.1,fillColor:"#333"},pattern={down:function(a){a.pos.y+=a.yspeed,fixBulletPos(a)},sideWays:function(a){a.pos.y+=a.yspeed,a.pos.x+=a.xspeed,fixBulletPos(a)},wavyDown:function(a,b){a.pos.y+=a.yspeed+Math.sin((frame+b)/30),a.pos.x+=2*Math.sin(frame/(40*a.xspeed)),fixBulletPos(a)},awayFromCenter:function(a,b){}},bullets={array:[]},func={applyPlayerSpeed:function(a){player.speed>0&&(kb.up&&(a.pos.y-=player.speed),kb.down&&(a.pos.y+=player.speed),kb.right&&(a.pos.x+=player.speed),kb.left&&(a.pos.x-=player.speed))},pytha:function(a,b){return Math.sqrt((a.x-b.x)*(a.x-b.x)+(a.y-b.y)*(a.y-b.y))},distanceCheck:function(a,b){return pytha=func.pytha(a.pos,b.pos),pytha<110&&draw.line(g,a.pos,b.pos,pytha/18.33333,"rgba(0,0,0,"+((-1*pytha+110)/330).toString()+")"),pytha<a.radius+b.radius},unclog:function(a,b){var c=Math.acos((a.pos.x-b.pos.x)/func.pytha(a.pos,b.pos));b.pos.x=a.pos.x-Math.cos(c)*(a.radius+b.radius);Math.sin(c)*(a.radius+b.radius);b.pos.y<a.pos.y?b.pos.y=a.pos.y-Math.sin(c)*(a.radius+b.radius):b.pos.y=a.pos.y+Math.sin(c)*(a.radius+b.radius)}},update={collisions:function(a,b){if(a.isConnected)for(var c=0,d=bullets.array.length;d>c;c++){var e=bullets.array[c];!e.isConnected&&func.distanceCheck(a,e)&&(func.unclog(a,e),e.isConnected=!0,player.speed-=e.radius/60)}else func.distanceCheck(player,a)?(func.unclog(player,a),a.isConnected=!0,player.speed-=a.radius/60):a.pattern(a,b)}},draw={circle:function(a,b){a.fillStyle=b.fillColor,a.lineWidth=3,a.beginPath(),a.arc(b.pos.x,b.pos.y,b.radius,0,2*Math.PI),a.fill()},line:function(a,b,c,d,e){a.beginPath(),a.moveTo(b.x,b.y),a.lineTo(c.x,c.y),a.lineWidth=d,a.strokeStyle=e,a.stroke()},clear:function(a){a.fillStyle="white",a.fillRect(0,0,gameCanvas.width,gameCanvas.height)},text:function(a,b,c){},menu:function(){}},kb={up:!1,down:!1,right:!1,left:!1};Mousetrap.bind("up",function(){kb.up=!0},"keydown"),Mousetrap.bind("up",function(){kb.up=!1},"keyup"),Mousetrap.bind("down",function(){kb.down=!0},"keydown"),Mousetrap.bind("down",function(){kb.down=!1},"keyup"),Mousetrap.bind("right",function(){kb.right=!0},"keydown"),Mousetrap.bind("right",function(){kb.right=!1},"keyup"),Mousetrap.bind("left",function(){kb.left=!0},"keydown"),Mousetrap.bind("left",function(){kb.left=!1},"keyup");var frame=-1,loop={menu:function(){frame++,requestAnimationFrame(loop.cur)},game:function(){frame++,draw.clear(g),func.applyPlayerSpeed(player),fixBulletPos(player),draw.circle(g,player);for(var a=0,b=bullets.array.length;b>a;a++){var c=bullets.array[a];c.xspeed+=.001,c.yspeed+=.001,c.isConnected&&func.applyPlayerSpeed(c),update.collisions(c,a),draw.circle(g,c)}frame%30===0&&generateBullet(randInt(0,gameCanvas.width)),requestAnimationFrame(loop.cur)}};loop.cur=loop.game,loop.cur();